<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opening WriteOffGenie...</title>
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <meta property="og:title" content="Join WriteOffGenie">
    <meta property="og:description" content="Tap to complete your signup.">
    <meta property="og:image" content="https://writeoffgenie.ai/logo_writeoffgenie.png">

    <style>
        body {
            font-family: -apple-system, system-ui, Roboto, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f9fafb;
            text-align: center;
            padding: 20px;
        }
        .logo { width: 80px; height: 80px; margin-bottom: 24px; }
        .spinner {
            border: 3px solid rgba(1, 28, 57, 0.1);
            width: 32px; height: 32px; border-radius: 50%;
            border-left-color: #011C39;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        h2 { color: #011C39; margin: 0 0 10px 0; font-size: 20px; font-weight: 600; }
        p { color: #6b7280; font-size: 14px; margin: 0 0 30px 0; max-width: 300px; line-height: 1.5; }
        .btn {
            display: none; /* Hidden by default */
            padding: 12px 30px;
            background-color: #011C39; color: white;
            text-decoration: none; border-radius: 8px;
            font-weight: 500; font-size: 15px;
            transition: transform 0.2s;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <img src="../favicon_writeoffgenie.svg" alt="Logo" class="logo" onerror="this.style.display='none'">
    
    <div class="spinner"></div>
    <h2 id="status">Launching App...</h2>
    <p id="sub-status">Connecting your invite code.</p>

    <a id="manual-btn" href="#" class="btn">Try Open App Again</a>

    <script>
        // --- 1. CONFIGURATION ---
        const SCHEME_PREFIX = "writeoffgenie://writeoffgenie.com/signuppage";

        // --- 2. LOGIC ---
        const params = new URLSearchParams(window.location.search);
        let rawCode = params.get('ref') || params.get('code') || '';
        const refCode = encodeURIComponent(rawCode);
        
        // Build the deep link
        const deepLink = `${SCHEME_PREFIX}?ref=${refCode}`;
        
        // Setup Button (In case they need to click manually)
        const btn = document.getElementById('manual-btn');
        btn.href = deepLink;

        // Copy logic ONLY on click (Stops the permission popup)
        btn.addEventListener('click', () => {
             if (rawCode && navigator.clipboard) {
                navigator.clipboard.writeText(rawCode).catch(() => {});
            }
        });

        // --- EXECUTION ---
        
        // 1. Try to open the app immediately
        window.location.href = deepLink;

        // 2. Wait 2.5 seconds. If the page is still visible, the app didn't open.
        setTimeout(() => {
            // Update UI to show "App not present"
            document.getElementById('status').innerText = "App not present";
            document.getElementById('sub-status').innerText = "We could not launch the app automatically.";
            
            // Hide spinner, show manual button
            document.querySelector('.spinner').style.display = 'none';
            btn.style.display = "inline-block";
            
        }, 2500);

    </script>
</body>
</html>